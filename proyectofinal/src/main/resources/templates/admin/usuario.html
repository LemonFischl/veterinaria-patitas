<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patitas al Rescate - Gestión de Usuario</title>
    <!--Librerías css-->
    <th:block th:insert="~{fragmentos :: Links-css}"/>
</head>

<body>
<!--Cabecera-->
<div th:replace="~{fragmentos :: Cabecera}"></div>

<div class="main-container">
    <!-- FORMULARIO DE REGISTRO -->
    <div class="form-container">
        <div class="form-card">
            <div class="card-header">
                <h4><i class="bi bi-person-plus"></i> Registrar Usuario</h4>
            </div>
            <div class="form-body">
                <form method="post" th:action="@{/admin/usuario/guardar}" th:object="${usuario}">

                    <!-- Mensaje de éxito -->
                    <div th:if="${exito}" class="alert-success">
                        <i class="bi bi-check-circle-fill"></i>
                        <span th:text="${exito}"></span>
                        <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
                    </div>

                    <!-- Mensaje de error -->
                    <div th:if="${error}" class="alert-danger">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        <span th:text="${error}"></span>
                        <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
                    </div>

                    <input type="hidden" th:field="*{id_usuario}"/>

                    <!-- Información básica -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="username"><i class="bi bi-person"></i> Username</label>
                            <input type="text" id="username" th:field="*{username}" required>
                            <div th:if="${#fields.hasErrors('username')}" th:errors="*{username}" class="error"></div>
                        </div>

                        <div class="form-group">
                            <label for="password"><i class="bi bi-lock"></i> Contraseña</label>
                            <input type="password" id="password" th:field="*{password}" required>
                            <div th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="error"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="nombre"><i class="bi bi-person-badge"></i> Nombre Completo</label>
                        <input type="text" id="nombre" th:field="*{nombre}">
                        <div th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}" class="error"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email"><i class="bi bi-envelope"></i> Correo Electrónico</label>
                            <input type="email" id="email" th:field="*{email}" required>
                            <div th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="error"></div>
                        </div>

                        <div class="form-group">
                            <label for="celular"><i class="bi bi-phone"></i> Celular</label>
                            <input type="text" id="celular" th:field="*{celular}" required>
                            <div th:if="${#fields.hasErrors('celular')}" th:errors="*{celular}" class="error"></div>
                        </div>
                    </div>

                    <!-- Selección de roles -->
                    <div class="form-group">
                        <label><i class="bi bi-person-gear"></i> Asignar Roles</label>

                        <div class="roles-box">
                            <div th:each="rol : ${listaRoles}" class="role-item">
                                <input type="checkbox"
                                       th:field="*{roles}"
                                       th:value="${rol.id}"
                                       th:id="${'rol_' + rol.id}"/>

                                <label th:for="${'rol_' + rol.id}">
                                    <span th:switch="${rol.name.name()}">
                                        <span th:case="'ROLE_ADMIN'">
                                            <i class="bi bi-shield-lock"></i> Administrador
                                        </span>
                                        <span th:case="'ROLE_VET'">
                                            <i class="bi bi-heart-pulse"></i> Veterinario
                                        </span>
                                        <span th:case="'ROLE_PACIENTE'">
                                            <i class="bi bi-person-circle"></i> Paciente
                                        </span>
                                        <span th:case="*">
                                            <i class="bi bi-person"></i> Otro
                                        </span>
                                    </span>
                                </label>
                            </div>
                        </div>
                        <div class="error" th:if="${#fields.hasErrors('roles')}" th:errors="*{roles}"></div>
                    </div>

                    <!-- Botones de acción -->
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            <i class="bi bi-check-circle"></i> Guardar Usuario
                        </button>
                        <a href="/admin/usuario/nuevo" class="btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancelar
                        </a>
                    </div>

                </form>
            </div>
        </div>
    </div>

        <!-- TABLA DE USUARIOS -->
    <div class="table-container">
        <div class="table-card">
            <div class="card-header">
                <h4><i class="bi bi-people"></i> Lista de Usuarios Registrados</h4>
            </div>
            <div class="table-wrapper">
                <table class="tablaData">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Nombre</th>
                        <th>Correo</th>
                        <th>Celular</th>
                        <th>Roles</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="u : ${usuarios}" class="usuario-row">
                        <td class="id-cell" th:text="${u.id_usuario}"></td>
                        <td class="username-cell text-truncate" th:text="${u.username}"></td>
                        <td class="nombre-cell text-truncate" th:text="${u.nombre}"></td>
                        <td class="email-cell text-truncate" th:text="${u.email}"></td>
                        <td class="celular-cell" th:text="${u.celular}"></td>
                        <td class="roles-cell">
                            <div class="roles-wrapper">
                            <span th:each="r : ${u.roles}"
                                  th:text="${#strings.replace(r.name, 'ROLE_', '')}"
                                  class="role-badge"
                                  th:classappend="${#strings.contains(r.name, 'ADMIN')} ? 'badge-admin' :
                                                  (${#strings.contains(r.name, 'VET')} ? 'badge-vet' : 'badge-paciente')"
                                  th:attr="data-role=${#strings.replace(r.name, 'ROLE_', '')}">
                            </span>
                            </div>
                        </td>
                        <td class="action-buttons">
                            <a th:href="@{/admin/usuario/editar(id=${u.id_usuario})}"
                               class="btn-action btn-edit"
                               title="Editar usuario">
                                <i class="bi bi-pencil-square"></i>
                            </a>
                            <a href="#"
                               th:attr="data-url=@{/admin/usuario/eliminar(id=${u.id_usuario})}"
                               class="btn-action btn-delete">
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
    <!--Footer-->
    <footer class="footer mt-auto mt-2 text-white" th:insert="~{fragmentos :: Pie}"></footer>

    <!-- Librerías de js-->
    <th:block th:insert="~{fragmentos :: Links-js}"/>
</body>
</html>
